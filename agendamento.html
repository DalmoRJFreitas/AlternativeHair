<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="dist/estilo.css">
    <title>Agendamento</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>
<body>
    <header>
        <h1><img id="logo" src="assets/img-ph/logo-clean50x50.png" alt="Logo Alternative Hair"></h1>
        <nav>
            <ul>
                <li><a href="sobre.html">Sobre</a></li>
                <li><a href="index.html">Home</a></li>
                <li><a href="penteados.html">Penteados</a></li>
                <li><a href="agendamento.html">Agendamento</a></li>
                <li><a href="contato.html">Contato</a></li>
            </ul>
        </nav>
    </header>

    <!-- Formulário de Cadastro -->
    <main>
        <section class="agendamento">
            <h1>Agende seu horário</h1>
            
            <form id="agendamento-form">
                <label for="data">Data:</label>
                <input type="date" id="data" name="data" required>
                <br>
                
                <label for="hora">Hora:</label>
                <input type="time" id="hora" name="hora" required>
                <br>
                
                <label for="cliente">Seu Nome:</label>
                <input type="text" id="cliente" name="cliente" required>
                <br>

                <label for="telefone_cliente">Telefone:</label>
                <input type="number" id="telefone_cliente" name="telefone_cliente" required>
                <br>
                
                <button type="submit">Confirmar Agendamento</button>
              </form>
            
              <div id="status"></div>
            
              <script>
                const form = document.getElementById('agendamento-form');
                const statusDiv = document.getElementById('status');
                
                const socket = io('https://shiny-space-guacamole-45p4jv9pvv5fqqpv-3000.app.github.dev/');
            
                // Conectar ao WebSocket para receber confirmações em tempo real
                socket.on('agendamento-confirmado', (data) => {
                  statusDiv.innerHTML += `<p>Agendamento confirmado para ${data.cliente} em ${data.data} às ${data.hora}!</p>`;
                });
            
                // Submeter formulário e confirmar agendamento
                form.addEventListener('submit', async (e) => {
                  e.preventDefault();
            
                  const data = document.getElementById('data').value;
                  const hora = document.getElementById('hora').value;
                  const cliente = document.getElementById('cliente').value;
                  const telefone_cliente= document.getElementById('telefone_cliente').value;
            
                  // Enviar requisição POST para verificar e confirmar
                  try {
                    const response = await fetch('https://shiny-space-guacamole-45p4jv9pvv5fqqpv-3000.app.github.dev/confirmar-agendamento', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({ data, hora, cliente, telefone_cliente }),
                    });
            
                    const result = await response.json();
            
                    if (result.sucesso) {
                      statusDiv.innerHTML = `<p>${result.message}</p>`;
                    } else {
                      statusDiv.innerHTML = `<p>${result.message}</p>`;
                    }
                  } catch (error) {
                    console.error('Erro ao agendar:', error);
                  }
                });
              </script>
    </main>
    <footer>
        <p>&copy; 2024 Salão Beleza. Todos os direitos reservados.</p>
        <ul>
            <li><a href="#">Instagram</a></li>
            <li><a href="#">Facebook</a></li>
            <li><a href="#">Contato</a></li>
        </ul>
    </footer>
</body>
</html>